{"version":3,"sources":["utils/axios.js","utils/index.js","scripts/actions/index.js","scripts/view/login/index.js"],"names":["baseURL","axios","defaults","token","fail","msg","Toast","hide","success","showToast","text","info","getTele","tele","sessionStorage","toString","split","splice","join","headers","common","post","interceptors","request","use","config","time","loading","console","log","error","offline","Promise","reject","response","data","type","createHashHistory","changeTime","getFoot","url","a","async","get","res","payload","changeFlag","changeMobile","getCode","Date","params","changeHead","pic","replace","userInfo","JSON","stringify","mobile","localStorage","resetHead","getHead","mReg","cReg","Login","connect","state","getIn","code","handleClear","props","dispatch","handleCheck","value","test","then","result","history","push","sendMsg","this","className","mode","style","borderBottom","icon","transform","onLeftClick","go","src","alt","ref","el","placeholder","onChange","display","onClick","inline","border","borderRadius","size","Component"],"mappings":"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","file":"static/js/10.acf9a89f.chunk.js","sourcesContent":["import axios from \"axios\";\r\nimport { Toast } from \"antd-mobile\"\r\nimport { history } from \"&\"\r\n\r\n// const baseURL = 'http://192.168.50.132:1232/';\r\n// const baseURL = 'http://123.57.6.111:1232/'; //公网\r\nconst baseURL = 'https://yeson.xyz:1232/';//域名\r\n\r\n\r\naxios.defaults.baseURL = baseURL;\r\n\r\nlet token = \"\";\r\naxios.defaults.headers.common[\"token\"] = token;//req.headers.token取\r\naxios.defaults.headers.post[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n\r\nfunction loadingToast(msg, time) {\r\n    msg = msg || \"请求中\";\r\n    time = time || 1;\r\n    Toast.hide();\r\n    Toast.loading(msg, time, () => {\r\n        console.log('Load complete !!!');\r\n    });\r\n}\r\nexport function fail(msg) {\r\n    Toast.hide();\r\n    Toast.fail(msg, 1);\r\n}\r\n\r\nexport function offline(msg) {\r\n    Toast.hide();\r\n    Toast.offline(msg, 1);\r\n}\r\n\r\nexport function success(msg) {\r\n    Toast.hide()\r\n    Toast.success(msg, 1);\r\n}\r\n\r\n//axios拦截器 Interceptors\r\n//request 请求发送之前的拦截器\r\naxios.interceptors.request.use(function (config) {\r\n    //配置动画\r\n    loadingToast();\r\n    token = sessionStorage.token ? sessionStorage.token : \"\";\r\n    config.headers[\"token\"] = token;\r\n    return config;\r\n}, function (error) {\r\n    //请求错误提示\r\n    offline(\"请求失败,网络异常\")\r\n    return Promise.reject(error);\r\n})\r\n\r\n//response 响应完成拦截器\r\naxios.interceptors.response.use(function (response) {\r\n    // console.log(response)\r\n    // if (response.data.code === \"3000\") {\r\n    //     history.push(\"/login\")\r\n    // }\r\n    // type  不存在    success\r\n    // type = 0  fail\r\n    // type = 1  success \r\n    if (!!response.data.type) {\r\n        success(response.data.msg);\r\n    } else {\r\n        if (response.data.type === 0) {\r\n            fail(response.data.msg)\r\n        } else {\r\n            success(response.data.msg)\r\n        }\r\n    }\r\n    // 成功的响应\r\n    return response;\r\n}, function (error) {\r\n    // 失败的响应 \r\n    fail(\"响应失败-服务器异常\")\r\n    return Promise.reject(error);\r\n})\r\n\r\n\r\nexport { axios, baseURL }","import { Toast } from \"antd-mobile\"\r\nimport { createHashHistory } from \"history\"\r\n\r\n\r\nexport { axios, baseURL } from \"./axios\"\r\n\r\nexport function showToast(text) {\r\n    Toast.info(text, 1);\r\n}\r\n\r\nexport function getTele(tele) {\r\n    tele = sessionStorage.tele.toString();\r\n    tele = tele.split(\"\")\r\n    tele.splice(3, 4, \"****\").join(\"\")\r\n    return tele\r\n}\r\n\r\nexport function getTime(time){\r\n    let date=new Date(time)\r\n    let year=date.getFullYear();\r\n    let month=date.getMonth()+1;\r\n    month=month>9?month:\"0\"+month;\r\n    let day=date.getDate();\r\n    day=day>9?day:\"0\"+day;\r\n    return `${year}-${month}-${day}`\r\n}\r\n\r\nexport const history = new createHashHistory()","import { axios, baseURL } from \"&\"\r\n\r\nexport const changeTime = {\r\n    type: \"changeTime\"\r\n}\r\n\r\nexport async function getFoot(url) {\r\n    const res = await axios.get(url);\r\n    return {\r\n        type: \"getFoot\",\r\n        payload: res.data\r\n    }\r\n}\r\n\r\nexport const changeFlag = () => {\r\n    // console.log(sessionStorage)\r\n    let flag = !!sessionStorage.tele;\r\n    return {\r\n        type: \"changeFlag\",\r\n        payload: flag,\r\n        // callback: () => {\r\n        //     history.push(\"/main/home\")\r\n        // }\r\n    }\r\n}\r\n\r\nexport const changeMobile = (payload) => {\r\n    return {\r\n        type: \"changeMobile\",\r\n        payload\r\n    }\r\n}\r\n\r\n\r\nexport async function getCode(payload) {\r\n    const res = await axios.post(\"/react/aly/sendSms\", { tele: payload, time: new Date() });\r\n    console.log(res)\r\n    return {\r\n        type: \"getCode\",\r\n        payload: res.data.params + \"\"\r\n        // payload:\"1234\"\r\n    }\r\n}\r\n\r\nexport async function changeHead(data) {\r\n    const res = await axios.post(\"/react/uploadImg\", data);\r\n    let url = \"http://img.cmvideo.cn:8080/publish/voms2/uic_service/picture/userImage/543/626/5181.jpg\";\r\n    if (res.data.pic) {\r\n        url = res.data.pic.replace(/public/, baseURL)\r\n        const userInfo = JSON.stringify({\r\n            mobile: res.data.mobile,\r\n            url\r\n        });\r\n        localStorage.userInfo = userInfo;\r\n    } else {\r\n        localStorage.userInfo = \"\";\r\n    }\r\n    return {\r\n        type: \"changeHead\",\r\n        payload: url\r\n    }\r\n}\r\n\r\nexport const resetHead = () => {\r\n    let url = \"http://img.cmvideo.cn:8080/publish/voms2/uic_service/picture/userImage/543/626/5181.jpg\";\r\n    return {\r\n        type: \"changeHead\",\r\n        payload: url\r\n    }\r\n}\r\n\r\nexport const getHead=(pic)=>{\r\n    console.log(pic)\r\n    return{\r\n        type: \"changeHead\",\r\n            payload: pic\r\n    }\r\n}\r\n\r\n","import \"./index.scss\";\r\nimport React, { Component } from \"react\"\r\nimport { connect } from \"react-redux\"\r\nimport { NavBar, Icon, Button, WingBlank, WhiteSpace } from \"antd-mobile\"\r\nimport { changeMobile, getCode, changeFlag } from \"~/actions\"\r\nimport { showToast, axios } from \"&\"\r\n\r\nconst mReg = /^1(3|4|5|6|7|8|9)\\d{9}$/;\r\nconst cReg = /^\\d{4}$/\r\n@connect(\r\n    state => ({\r\n        mobile: state.getIn([\"data\", \"mobile\"]),\r\n        code: state.getIn([\"data\", \"code\"])\r\n    })\r\n)\r\n\r\nclass Login extends Component {\r\n    handleClear = () => {\r\n        this.props.dispatch(changeMobile(\"\"))\r\n    }\r\n    handleCheck = () => {\r\n        let tele = this.tele.value;\r\n        let code = this.code.value;\r\n        if (this.tele.value) {\r\n            if (mReg.test(this.tele.value)) {\r\n                if (this.code.value) {\r\n                    if (cReg.test(this.code.value)) {\r\n                        // console.log(this.props.code)\r\n                        axios.post(\"/react/checkCode\", { tele, code }).then(result => {\r\n                            if (result.data.token) {\r\n                                sessionStorage.tele = this.tele.value;\r\n                                sessionStorage.token = result.data.token;\r\n                                this.props.dispatch(changeFlag(this.props.history));\r\n                                // setTimeout(() => {\r\n                                    this.props.history.push(\"/main/home\")\r\n                                // }, 1000)\r\n                            }\r\n                        })\r\n\r\n                    } else {\r\n                        showToast(\"短信验证码格式不对\")\r\n                    }\r\n                } else {\r\n                    showToast(\"短信验证码不能为空\")\r\n                }\r\n            } else {\r\n                showToast(\"手机号码格式不对\")\r\n            }\r\n        } else {\r\n            showToast(\"手机号码不能为空\")\r\n        }\r\n    }\r\n    sendMsg = () => {\r\n        if (this.tele.value) {\r\n            // console.log(this.tele.value)\r\n            // console.log(mReg.test(this.tele.value))\r\n            if (mReg.test(this.tele.value)) {\r\n                this.props.dispatch(getCode(this.tele.value))\r\n            } else {\r\n                showToast(\"手机号码格式不对\")\r\n            }\r\n        } else {\r\n            showToast(\"手机号码不能为空\")\r\n        }\r\n    }\r\n    render() {\r\n        const {\r\n            history,\r\n            dispatch,\r\n            mobile,\r\n        } = this.props\r\n        return (\r\n            <div className=\"body\">\r\n                <NavBar\r\n                    mode=\"light\"\r\n                    style={{ borderBottom: '1px solid #EEF1F3' }}\r\n                    icon={<Icon style={{ transform: 'scale(1.5)' }} type=\"left\" />}\r\n                    onLeftClick={() => history.go(-1)}\r\n                >短信登录</NavBar>\r\n                <div className=\"logo\">\r\n                    <img src=\"https://passport.migu.cn/mobile/images/migu-video.png\" alt=\"\" />\r\n                </div>\r\n                <WingBlank>\r\n                    <div className=\"login\">\r\n                        <div className=\"tele\" ref=\"one\">\r\n                            <input ref={el => this.tele = el} type=\"text\" placeholder=\"手机号\" value={mobile} onChange={() => dispatch(changeMobile(this.tele.value))} />\r\n                            <div className=\"clear\" style={{ display: mobile ? 'block' : 'none' }} onClick={this.handleClear}>x</div>\r\n                        </div>\r\n                        <div className=\"code\" ref=\"two\">\r\n                            <input ref={el => this.code = el} type=\"text\" placeholder=\"短信验证码\" />\r\n                            <Button className=\"get\" onClick={this.sendMsg} inline style={{ border: \"#8A909B 1px solid\", borderRadius: '999px' }} size=\"small\">获取验证码</Button>\r\n                        </div>\r\n                        <WhiteSpace size=\"xl\" />\r\n                        <div className=\"btn\">\r\n                            <Button type=\"primary\" style={{ borderRadius: '999px' }} onClick={this.handleCheck}>登录</Button>\r\n                        </div>\r\n                    </div>\r\n                </WingBlank>\r\n            </div>\r\n        )\r\n    }\r\n}\r\nexport default Login\r\n"],"sourceRoot":""}